---
title: "Experiment Report"
author: "Kadir Korkmaz"
date: "December 4, 2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
  fig_width: 6 
  fig_height: 2 
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

#install.packages("data.table", repos = "https://cran.rstudio.com")
library(data.table)


dataFolderName <- "2020-12-09_15:31:05"

# Folder which contains *.stat files
dataFolderPath <- paste( "~/Git/experiment-automation/output/stats/", dataFolderName, sep="")

# Lists all stat files
list_of_files <- list.files(path = dataFolderPath, recursive = TRUE, pattern = "\\.stat$",  full.names = TRUE)


# Read all the files and create a FileName column to store filenames
DT <- rbindlist(sapply(list_of_files, fread, simplify = FALSE),
                use.names = TRUE, idcol = "FileName")

experiment_df <- as.data.frame(DT)

experiment_df$FileName <- basename(experiment_df$FileName)

colnames(experiment_df)[2] = "DateTime"
colnames(experiment_df)[3] = "Round"
colnames(experiment_df)[4] = "BlockPropagation"
colnames(experiment_df)[5] = "BAWithOutFinalStep"
colnames(experiment_df)[6] = "BAWithFinalStep"
colnames(experiment_df)[7] = "ConsensusType"
colnames(experiment_df)[8] = "BlockType"
colnames(experiment_df)[9] = "BlockHash"


number_of_machines <- nrow( experiment_df %>% group_by(FileName) %>% summarise(count = n()) )

  


```


# Experiment Configuration

Number of machines is **`r number_of_machines`**

Bandwidth limit per process using Trickle: **trickle -s -v  -d 20000 -u 20000**

tc Delay on outgoing channel: **none**

\newpage
## Node Configuration

```{r, echo=FALSE}

#install.packages("readr")
library(readr)
#install.packages("jsonlite")
library(jsonlite)

node_condiguration <- read_file("~/Git/experiment-automation/config.json")
prettify(node_condiguration, indent = 4)


```


\newpage
# Sanity Check

```{r, echo=FALSE}

experiment_df %>% 
  group_by(FileName) %>%
  summarise(
    count = n(),
    mean_bp = mean(BlockPropagation, na.rm=TRUE),
    mean_ba_wo_final = mean(BAWithOutFinalStep, na.rm=TRUE),
    mean_ba_w_final = mean(BAWithFinalStep, na.rm=TRUE),
    max_round = max(Round)
  )

```

The number of rows in data set is **`r nrow(experiment_df)`**

Maximum round number is **`r max(experiment_df$Round)`**


\newpage
# Overal Results

```{r, echo=FALSE}

boxplot(experiment_df[4:6],
  main = "",
  xlab = "Step",
  ylab = "Seconds",
  col = "orange",
  border = "brown",
  horizontal = FALSE,
  notch = FALSE
)

```




\newpage
# Block Propagation Statistics

```{r, echo=FALSE}

hist(experiment_df$BlockPropagation, main="", xlab = "")

```

```{r, echo=FALSE}

boxplot(experiment_df$BlockPropagation,
  main = "",
  xlab = "Seconds",
  ylab = "Block Propagation",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = FALSE
)

```

\newpage
# BA Elapsed Time Without Final Step Statistics


```{r, echo=FALSE}

hist(experiment_df$BAWithOutFinalStep, main="", xlab = "")

```

```{r, echo=FALSE}

boxplot(experiment_df$BAWithOutFinalStep,
  main = "",
  xlab = "Seconds",
  ylab = "BA Without Final Step",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = FALSE
)

```



\newpage
# BA Elapsed Time With Final Step Statistics

```{r, echo=FALSE}

hist(experiment_df$BAWithFinalStep, main="", xlab = "")

```

```{r, echo=FALSE}

boxplot(experiment_df$BAWithFinalStep,
  main = "",
  xlab = "Seconds",
  ylab = "BA With Final Step",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = FALSE
)

```




